# Privileges

У пользователей могут быть установлены привилегии, что позволяет пользователям взаимодействовать с объектами в обход ACLs. Например, SeDebugPrivilege позволяет писать/читать любой процесс на машине, даже если нет прав на это.

Опасные привилегии в Windows:

* **SeDebugPrivilege**: читать и писать в любой процесс, например, lsass
* **SeImpersonatePrivilege**: Пользователь может получить токены безопасности других пользователей на машине. Если impersonate token level — SecurityDelegation, то пользователь может использовать эти токены для получения доступа к другим компьютерам в домене от лица пользователей этого компьютера. Если imersonate token level — SecurityImpersonation, то пользователь может получить доступ от лица других пользователей только на этом же компьютере. Например, если мы скомпрометировали веб-сервер, мы возможно сможем сделать что-то от лица доменного пользователя через [incognito](https://labs.f-secure.com/archive/incognito-v2-0-released/). По умолчанию, если мы хотим повысить привилегии на локальной машине через SeImpersonatePrivilege, можем использовать [potato](https://jlajara.gitlab.io/others/2020/11/22/Potatoes\_Windows\_Privesc.html).

В AD некоторые привилегии крайне полезны для атакующего:

* **SeEnableDelegationPrivilege**: Должен быть установлен на DC для локального пользователя (локальная привилегия), и позволяет изменять [msDS-AllowedToDelegateTo](https://docs.microsoft.com/en-us/openspecs/windows\_protocols/ms-ada2/86261ca1-154c-41fb-8e5f-c6446e77daaa) свойство других пользователей, а также менять в UserAccountControl флаги `TRUSTED_FOR_DELEGATION` and `TRUSTED_TO_AUTH_FOR_DELEGATION`. Другими словами, позволяет управлять делегированием и позволяет атакующему выполнять PrivEsc на домене. По умолчанию, выдается только аккаунту Administrator на DC.
* **SeBackupPrivilege**: Привилегия позволяет читать любые файлы на DC. By default is given to **Backup Operators**, **Server Operators** and **Administrators** groups.
* **SeRestorePrivilege**: Позволяет записать на DC любой файл из бэкапа. By default is given to **Backup Operators**, **Server Operators** and **Administrators** groups. Позволяет атакующему вносить изменения в базу AD.
* **SeTakeOwnershipPrivilege**: Позволяет поменять владельца объекта.

О других привилегиях смотри в [https://github.com/hatRiot/token-priv](https://github.com/hatRiot/token-priv)
