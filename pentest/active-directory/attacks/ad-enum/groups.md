# Groups

## Общие команды

Все группы в домене

{% tabs %}
{% tab title="PowerView" %}
```
Get-NetGroup
Get-NetGroup *admin*
```
{% endtab %}

{% tab title="AD Module" %}
```
Get-ADGroup -Filter * | select Name
Get-ADGroup -Filter 'Name -like "*admin*"' | select Name
```
{% endtab %}
{% endtabs %}

Все пользователи группы администраторов домена

{% tabs %}
{% tab title="PowerView" %}
```
Get-NetGroupMember -GroupName "Domain Admins"
```
{% endtab %}

{% tab title="AD Module" %}
```
Get-ADGroupMember -Identity "Domain Admins" -Recursive
```
{% endtab %}
{% endtabs %}

Все группы, в которые входит пользователь

{% tabs %}
{% tab title="PowerView" %}
```
Get-NetGroup –UserName "testuser"
```
{% endtab %}

{% tab title="AD Module" %}
```
Get-ADPrincipalGroupMembership -Identity labuser
```
{% endtab %}
{% endtabs %}

## Немного теории

Группы Active Directory бывают двух типов.

1. **Группы распространения** — используются для списков рассылки электронной почты и не могут служить для контроля доступа к ресурсам, поэтому они нам неинтересны.
2. **Группы безопасности** — могут применяться для контроля доступа и добавлены в списки контроля доступа.

Независимо от того, к какому типу относится группа, она задается битом в свойстве `groupType`.

Группы безопасности могут иметь одну из трех областей действия. Область действия группы влияет на то, какие типы групповых объектов могут быть добавлены в нее и в какие другие группы группа может быть вложена.

1. Глобальные группы могут быть вложены в локальные группы домена, универсальные группы и другие глобальные группы в одном домене.
2. Универсальные группы могут быть вложены в локальные группы домена и другие универсальные группы в любом домене.
3. Локальная группа домена не может быть вложена в глобальную или универсальную группу.

Найти все группы какого-то типа можно с помощью PowerView.

* `Get-DomainGroup -GroupScope DomainLocal` — найти локальные группы;
* `Get-DomainGroup -GroupScope NotDomainLocal` — найти нелокальные группы;
* `Get-DomainGroup -GroupScope Global` — найти глобальные группы;
* `Get-DomainGroup -GroupScope NotGlobal` — найти неглобальные группы;
* `Get-DomainGroup -GroupScope Universal`— найти универсальные группы;
* `Get-DomainGroup -GroupScope NotUniversal` — найти неуниверсальные группы;
* `Get-DomainGroup -GroupProperty Security` — найти группы безопасности;
* `Get-DomainGroup -GroupProperty Distribution` — найти группы распространения;
* `Get-DomainGroup -GroupProperty CreatedBySystem` — найти группы, созданные системой.

Получить список всех пользователей поможет модуль PowerShell `activedirectory`, достаточно выполнить команду `Get_ADUser -filter *`. Получить список групп, в которых числится определенный пользователь, можно командой `Get-NetGroup -UserName [user]`.

Также есть возможность узнать список компьютеров, к которым имеет доступ конкретный пользователь или группа. Для этого используй команды

```
> Find-GPOLocation -UserName [user]
> Find-GPOLocation -GroupName [group]
```

Но можно вернуть и список объектов, имеющих доступ к определенному компьютеру. Для этого есть команда

```
Find-GPOComputerAdmin -ComputerName [computer] -Recurse
```

Еще очень важная информация, которую мы можем получить: какие объекты групповой политики применяются к конкретной машине. Делается это командой

```
Get-DomainGPO -ComputerIdentity [PC_id] -Properties displayname
```

Важно, что все эти функции позволяют запрашивать информацию без повышенных привилегий.
