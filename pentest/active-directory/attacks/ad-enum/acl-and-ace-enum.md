# ACL & ACE Enum

ACL (Списки управления доступом) & ACE (Запись управления доступом)

{% tabs %}
{% tab title="PowerView" %}
```
Получить ACLs для конкретного объекта
Get-ObjectAcl -SamAccountName testeuser -ResolveGUIDs

Получить ACLs по конкретному префиксу, который можно использовать для поиска
Get-ObjectAcl -ADSprefix 'CN=Administrator,CN=Users' -Verbose

Для просмотра интересующих ACEs
Invoke-ACLScanner –ResolveGUIDs
```
{% endtab %}

{% tab title="AD Module" %}
```
То же самое, но без GUID'ов
(Get-Acl 'AD:\CN=testuser,CN=Users,DC=somedc,DC=powershell,DC=local').Access
```
{% endtab %}
{% endtabs %}

aclpwn script [https://github.com/fox-it/aclpwn.py](https://github.com/fox-it/aclpwn.py)

Пример ошибок конфигураций в ACL & ACE:

* Компьютер (пользователь SYSTEM) может изменять пароль другого пользователя без подтверждения

```
ObjectDN                : CN=victim user,CN=Users,DC=domain,DC=corp
AceQualifier            : AccessAllowed
ActiveDirectoryRights   : ExtendedRight
ObjectAceType           : User-Force-Change-Password
AceFlags                : None
AceType                 : AccessAllowedObject
InheritanceFlags        : None
SecurityIdentifier      : S-1-5-21-3045844142-1034451371-184451441-1166
IdentityReferenceName   : HACKER-MACHINE$
IdentityReferenceDomain : domain.corp
IdentityReferenceDN     : CN=HACKER-MACHINE,CN=Computers,DC=domain,DC=corp
IdentityReferenceClass  : computer
```

* Компьютер (пользователь SYSTEM) может добавлять пользователей в группу `GroupVictims`

```
ObjectDN                : CN=GroupVictims,CN=Users,DC=domain,DC=corp
AceQualifier            : AccessAllowed
ActiveDirectoryRights   : GenericAll
ObjectAceType           : None
AceFlags                : None
AceType                 : AccessAllowed
InheritanceFlags        : None
SecurityIdentifier      : S-1-5-21-3045844142-1034451371-184451441-1166
IdentityReferenceName   : HACKER-MACHINE$
IdentityReferenceDomain : domain.corp
IdentityReferenceDN     : CN=HACKER-MACHINE,CN=Computers,DC=domain,DC=corp
IdentityReferenceClass  : computer
```
