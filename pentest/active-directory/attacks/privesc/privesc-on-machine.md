# PrivEsc on Machine

## Examples

### Проверить сразу все

Импортируем модуль PrivEsc, из PowerSploit (модуль не детектится WindowsDefender, можно использовать как отдельные скрипты). Вот так запускаем все проверки. Далее будут частные случаи разобраны.

```
Invoke-AllChecks
```

### Обнаружен в PATH путь для DLL hijacking

Invoke-AllChecks подсветит, как эксплуатировать. Пример (есть и другие параметры)

```
Write-HijackDll -DllPath <Path 2 DLL> -UserName zfr -Password testtest
```

### Найти сервисы, которые запускают свои бинари не в кавычках, и пути до которых имеют пробелы

Пример: Есть путь `C:\Program Files\Some Test\binary.exe`

Если путь необрамлен ковычками, то в данном случае Windows будет пытаться найти и запустить файл в следующем порядке:

```
C:\Program.exe
C:\Program Files\Some.exe
C:\Program Files\Some Test\binary.exe
```

Соответственно, если binary.exe выполняется с повышенными привилегиями и у вас будет возможность разместить на диске C файл Program.exe, то вместо исходного бинарника винда выполнит ваш, что поднимет ваши привилегии в системе.&#x20;

Данный способ называется **Неквотируемые пути служб** (Unquoted Service Paths).&#x20;

```
Найти Unquoted Service Paths:
Get-ServiceUnquoted -Verbose

Найти сервисы, в директории с исполняемыми файлами которых текущий пользователь может писать
Get-ModifiableServiceFile -Verbose

Найти все сервисы, которые текущий пользователь может изменять
Get-ModifiableService -Verbose 
```

Вообще, у этого модуля множество есть проверок и техник используется

### Проверить права пользователя

Проверить наличие привилегий: whoami /priv

Например: наличие привилегии `SeImpersonatePrivilege` позволяет злоумышленнику повысить свои привилегии до `nt authority\system`, например используя `juicy-potato` или [SweetPotato](https://github.com/CCob/SweetPotato).

## Tools

PrivEsc from PowerSploit
