# Services / SPN

Когда нужно повысить привилегии, злоумышленники обычно используют учетные записи служб, поскольку у таких учеток больше прав, но нет строгой политики смены пароля через заданный промежуток времени. То есть если скомпрометировать их, то потом можно долго оставаться незамеченным

Сканирование SPN — это **первое**, что обычно **делает** злоумышленник или **пентестер** при поиске служб в среде Active Directory. Основное преимущество этого метода по сравнению со сканированием сетевых портов в том, что не требуется взаимодействие с каждым узлом сети для проверки служебных портов. Сканирование SPN позволяет обнаружить службы с помощью запросов LDAP к контроллеру домена. Так как запросы SPN — нормальное поведение проверки подлинности Kerberos, этот способ сканирования обнаружить очень сложно (даже почти нереально), в отличие от сканирования портов.

Выполнить сканирование SPN можно с помощью [скрипта на PowerShell](https://github.com/PyroTek3/PowerShell-AD-Recon/blob/master/Discover-PSMSSQLServers).

Важно: даже если сервис сейчас не запущен или не активен, он может быть все равно зарегистрирован в AD Database (обязательно регистрируются те, что используют Kerberos). Из-за этого даже старые сервисы могут быть использованы для Account Takeover via **Kerberoast**.

Мы можем запросить Kerberos тикет для любого сервиса, зарегистрированного в домене. Часть тикета будет зашифрована на service user secret (NT-hash или Kerberos keys) полученного из пароля. Соотв, сохраняем тикет и пробуем **перебрать** пароль. Для **сервисов компьютера** это не принесет пользы, тк пароль очень сложный, но **сервисы пользователя** могут иметь слабые пароли.
