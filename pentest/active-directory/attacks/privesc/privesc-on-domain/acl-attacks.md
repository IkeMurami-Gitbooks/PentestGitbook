# ACL Attacks

Так как в домене могут быть определены огромное количество ACLs, то управлять этим очень сложно. Следовательно, возможны нарушения конфигурации ACLs. Вот некоторые примеры:

* **Изменение пароля пользователя**: если имеем права User-Force-Change-Password или GenericAll над аккаунтом пользователя, то мы можем захватить аккаунт пользователя
* **Make user Kerberoasteable**: если мы можем добавить SPN в ServicePrincipleName свойство пользователя, то мы можем провести атаку Kerberoast на пользователя и попробовать перебрать тикет. Для того, чтобы добавить SPN, мы должны to have the [Validated-SPN](https://docs.microsoft.com/en-us/windows/win32/adschema/r-validated-spn) validated write with WritePropertyExtended, or GenericWrite or GenericAll
* **Execute malicious script**: Если можем менять ScriptPath свойство пользователя, с правами WriteProperty, GenericWrite или GenericAll, then you can set a malicious file that is going to be execute the next time that the user logs on. You can use [an UNC path to point to a share](https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-acls-aces#genericwrite-on-user). You may also require to enable the **SCRIPT** flag of the UserAccountControl property.
* **Add users to group**: If you can modify the **members** property of a group, with WriteProperty, GenericWrite or GenericAll, then you can add any member to the group. If you have the right for Self-Membership, you can add your current user to that group.
* [Kerberos RBCD attack](https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/resource-based-constrained-delegation-ad-computer-object-take-over-and-privilged-code-execution): If you can modify the `msDS-AllowedToActOnBehalfOfOtherIdentity` of a computer account, with WriteProperty, GenericWrite or GenericAll, then you enable Kerberos Resource Based Constrained Delegation for another user to the computer services and finally get access as admin to the computer.
* [LAPS password](https://adsecurity.org/?p=3164): If you can read the **ms-Mcs-AdmPwd** computer confidential property used by LAPS to store the machine local administrators password, then you could read it an access as local admin to the machine. You can identify the use of LAPS in a machine by checking if the **ms-Mcs-AdmPwdExpirationTime** property exists in its computer account.
* [DCSync attack](https://adsecurity.org/?p=1729): If you have the `DS-Replication-Get-Changes` and `DS-Replication-Get-Changes-All` extended rights over the domain object, then you can perform a DCSync attack to dump the database contents.
* **GPO abuse**: If you can modify the `GPC-File-Sys-Path` of a [Group Policy Container](https://zer1t0.gitlab.io/posts/attacking\_ad/#group-policy-container) with WriteProperty, GenericWrite or GenericAll, then you can modify the GPO and perform code execution in the computers affected by the GPO.
* **Modify ACLs**: If you have the WriteDacl right (or GenericAll), then you can create ACE to give any right in the object and perform some of the previous attack. Also, if you have the WriteOwner right, since the owner object has implicit WriteDacl right, you can change the object owner to your user and then modify ACLs.

Besides the possibilities of elevating privileges, ACLs can be also pretty useful and stealthy if you want to [create backdoors](https://www.specterops.io/assets/resources/an\_ace\_up\_the\_sleeve.pdf) to keep your access in the network. In order to create backdoors there are a few tricks about hiding the malicious ACEs described in the [An ACE Up the Sleeve](https://www.specterops.io/assets/resources/an\_ace\_up\_the\_sleeve.pdf) whitepaper written by the specterops team that you should check.

