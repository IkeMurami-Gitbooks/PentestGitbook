# AppLocker



## About

AppLocker — технология, которая позволяет системному администратору блокировать выполнение определенных исполняемых файлов на компьютерах в сети. То есть можно создать правила, по которым будет выдаваться разрешение на выполнение или отказ. Например, можно проверять уникальные идентификаторы файлов и разрешать запуск только определенным пользователям или группам.

Обычно конфигурация AppLocker применяется через объект групповой политики. В таком случае легко извлечь конфигурацию из `SYSVOL`, если у нас есть доступ на чтение к общему ресурсу. Как просмотреть объекты групповой политики и к каким машинам они применяются, смотри в разделе LAPS. Отличается только путь:

```
Software\Policies\Microsoft\Windows\SrpV2\%ext%\xxxxxxxx-xxx-xxx-xxx-xxxxxxxxxxxx
```

Есть три способа применения запрещающего правила: `Publisher`, `Path` и `File Hash`.

На месте `%ext%` используй ключи: `Appx`, `Exe`, `Dll`, `Msi`, `Script`.

## AppLocker Bypass

Один из способов обхода ограничений на исполнение произвольного кода — использование разрешенного исполняемого файла `rundll32.exe` и DLL (`reverse_32.dll`), где определены функции, которые пытается выполнить злоумышленник.

```
> rundll32.exe shell32.dll,Control_RunDLL C:\AVDirectoryNotCheck\reverse_32.dll
```

### Mitigation

1. Добавить ограничение на запуск DLL в правила AppLocker.
2. В случае невозможности добавления ограничения на запуск DLL рассмотреть возможность ограничения запуска следующих исполняемых файлов (их запуск позволяет выполнить код из произвольной библиотеки DLL):
   * rundll32.exe
   * regsvr32.exe
   * msbuild.exe
   * regvcs.exe
   * regasm.exe
   * mshta.exe
3. Добавить ограничение на запуск файла `installutil.exe`, входящего в состав пакета `.NET Framework`. Выполнение `installutil.exe` позволяет запускать специальным образом подготовленные EXE-файлы.
