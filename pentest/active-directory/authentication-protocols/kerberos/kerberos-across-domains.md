# Kerberos Across domains

Можно аутентифицировать пользователя в рамках одного домена по Kerberos (через ST), но как Kerberos работает над trusted domains? Как происходит аутентификация при запросе доступа к службе в другом домене?&#x20;

Необходимо запросить ST для внешнего DC. Для этого нам нужен TGT для этого сервера — inter-realm TGT — он выдается нашим KDC, когда мы запрашиваем ST для службы в другом домене.

Как происходит аутентификация, если клиент в домене `foo.com` запросит доступ к службе `srvbar` в домене `bar.com`:

```
KDC foo.com                                                    KDC bar.com
    .---.                                                          .---.
   /   /|                       .---4) TGS-REQ (TGT bar)------->  /   /|
  .---. |                       |    + SPN: HTTP\srvbar          .---. |
  |   | '                       |    + TGT client > bar.com      |   | '
  |   |/                        |                                |   |/ 
  '---'                         |   .--5) TGS-REP--------------< '---'
  v  ^                          |   | + ST client > HTTP/srvbar
  |  |                          |   |
  |  |                          ^   v                                   .---.
  |  '-2) TGS-REQ (TGT foo)--<  _____                                  /   /|
  |   + SPN: HTTP\srvbar       |     | <----------1) SPNEGO---------> .---. |
  |   + TGT client > foo.com   |_____|                                |   | '
  |                            /:::::/ >----6) AP-REQ---------------> |   |/
  '--3) TGS-REP--------------> client     + ST client > HTTP/srvbar   '---'  
    + TGT client > bar.com    (foo.com)                               srvbar
                                                                    (bar.com)
```

Любопытно то, что обычно inter-realm TGT шифруются с использованием алгоритма RC4 вместо AES256.
